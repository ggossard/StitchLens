@using StitchLens.Data.Models
@model StitchLens.Web.Models.PricingViewModel
@{
    ViewData["Title"] = "Pricing Plans";
}

@if (TempData["ErrorMessage"] != null) {
    <div class="pricing-alert alert-error">
        <div class="container">
            <div class="alert-content">
                <i class="fas fa-exclamation-triangle"></i>
                <div>
                    <strong>Download Limit Reached!</strong>
                    <p>@TempData["ErrorMessage"]</p>
                </div>
                <button type="button" class="alert-close" data-bs-dismiss="alert">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
}
@if (TempData["SuccessMessage"] != null) {
    <div class="pricing-alert alert-success">
        <div class="container">
            <div class="alert-content">
                <i class="fas fa-check-circle"></i>
                <div>
                    <p>@TempData["SuccessMessage"]</p>
                </div>
                <button type="button" class="alert-close" data-bs-dismiss="alert">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>
}

<!-- Pricing Hero Section -->
<section class="pricing-hero-section">
    <div class="container">
        <div class="text-center">
            <h1 class="pricing-hero-title">Invest in Your Craft</h1>
            <p class="pricing-hero-subtitle">
                Choose the plan that fits your creative journey. From hobby stitchers to professional designers,
                <br>we have a plan that helps you bring your visions to life.
            </p>
        </div>
    </div>
</section>

<div class="container pricing-container">

    <!-- Pricing Cards -->
    <div class="row g-4 pricing-cards-row">
        @foreach (var tier in Model.Tiers) {
            <div class="col-lg-3 col-md-6">
                <div class="pricing-card @(tier.IsPopular ? "pricing-card-popular" : "") @(tier.IsCurrent ? "pricing-card-current" : "")">

                    @if (tier.IsPopular) {
                        <div class="popular-badge">
                            <i class="fas fa-star"></i> Most Popular
                        </div>
                    }

                    @if (tier.IsCurrent) {
                        <div class="current-badge">
                            <i class="fas fa-check"></i> Current Plan
                        </div>
                    }

                    <div class="pricing-card-header">
                        <!-- Tier Icon -->
                        <div class="tier-icon tier-icon-@tier.Tier.ToString().ToLower()">
                            @if (tier.Tier == SubscriptionTier.Free) {
                                <i class="fas fa-seedling"></i>
                            }
                            else if (tier.Tier == SubscriptionTier.Hobbyist) {
                                <i class="fas fa-heart"></i>
                            }
                            else if (tier.Tier == SubscriptionTier.Creator) {
                                <i class="fas fa-store"></i>
                            }
                            else {
                                <i class="fas fa-building"></i>
                            }
                        </div>

                        <!-- Tier Name -->
                        <h3 class="tier-name">@tier.Name</h3>

                        <!-- Price -->
                        <div class="tier-price">
                            @if (tier.Tier == SubscriptionTier.Free) {
                                <div class="price-amount">Free</div>
                                <div class="price-period">Forever</div>
                            }
                            else if (tier.Tier == SubscriptionTier.Custom) {
                                <div class="price-amount-custom">Let's Talk</div>
                                <div class="price-period">Custom pricing</div>
                            }
                            else {
                                <div class="price-amount">
                                    <span class="price-currency">$</span>@tier.MonthlyPrice.ToString("0")
                                </div>
                                <div class="price-period">per month</div>
                            }
                        </div>
                    </div>

                    <div class="pricing-card-body">
                        <!-- Description -->
                        <p class="tier-description">@tier.Description</p>

                        <!-- Features List -->
                        <ul class="features-list">
                            @foreach (var feature in tier.Features) {
                                <li class="feature-item">
                                    <i class="fas fa-check-circle"></i>
                                    <span>@feature</span>
                                </li>
                            }
                        </ul>
                    </div>

                    <div class="pricing-card-footer">
                        @if (tier.IsCurrent) {
                            <button class="btn-pricing btn-pricing-current" disabled>
                                <i class="fas fa-check me-2"></i>Your Current Plan
                            </button>
                        }
                        else if (tier.Tier == SubscriptionTier.Custom) {
                            <a href="mailto:sales@stitchlens.com" class="btn-pricing btn-pricing-custom">
                                <i class="fas fa-envelope me-2"></i>@tier.ButtonText
                            </a>
                        }
                        else if (tier.Tier == SubscriptionTier.Free) {
                            @if (!Model.IsAuthenticated) {
                                <a asp-controller="Account" asp-action="Register" class="btn-pricing btn-pricing-free">
                                    <i class="fas fa-user-plus me-2"></i>Get Started Free
                                </a>
                            }
                            else {
                                <button class="btn-pricing btn-pricing-current" disabled>
                                    Current Plan
                                </button>
                            }
                        }
                        else {
                            @if (Model.IsAuthenticated) {
                                <a asp-controller="Account" asp-action="Subscribe" asp-route-tier="@tier.Tier" class="btn-pricing btn-pricing-@tier.Tier.ToString().ToLower()">
                                    <i class="fas fa-rocket me-2"></i>@tier.ButtonText
                                </a>
                            }
                            else {
                                <a asp-controller="Account" asp-action="Register" asp-route-returnUrl="@Url.Action("Subscribe", "Account", new { tier = tier.Tier })" class="btn-pricing btn-pricing-@tier.Tier.ToString().ToLower()">
                                    <i class="fas fa-user-plus me-2"></i>Sign Up to Subscribe
                                </a>
                            }
                        }
                    </div>
                </div>
            </div>
        }
    </div>

    <!-- Money Back Guarantee -->
    <div class="guarantee-banner">
        <div class="guarantee-icon">
            <i class="fas fa-shield-alt"></i>
        </div>
        <div class="guarantee-content">
            <h4 class="guarantee-title">14-Day Money-Back Guarantee</h4>
            <p class="guarantee-text">
                Try any paid plan risk-free. If you're not completely satisfied, we'll refund your payment—no questions asked.
            </p>
        </div>
    </div>

    <!-- FAQ Section -->
    <div class="faq-section">
        <div class="row">
            <div class="col-lg-8 mx-auto">
                <div class="faq-header">
                    <div class="faq-icon">
                        <i class="fas fa-question-circle"></i>
                    </div>
                    <h2 class="faq-title">Frequently Asked Questions</h2>
                    <p class="faq-subtitle">Everything you need to know about our plans</p>
                </div>

                <div class="faq-accordion">
                    <div class="faq-item">
                        <button class="faq-question active" type="button" data-bs-toggle="collapse" data-bs-target="#faq1">
                            <span>What happens when I reach my download limit?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div id="faq1" class="faq-answer collapse show">
                            <div class="faq-answer-content">
                                You can still create and preview patterns to your heart's content! PDF downloads will pause until your next billing cycle, or you can upgrade anytime for immediate access. We never want to interrupt your creative flow.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <button class="faq-question collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                            <span>Can I change plans anytime?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div id="faq2" class="faq-answer collapse">
                            <div class="faq-answer-content">
                                Absolutely! Your creative needs evolve, and so should your plan. Upgrades take effect immediately, giving you instant access to more downloads. Downgrades happen at your next billing date, so you keep all benefits until then.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <button class="faq-question collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                            <span>What payment methods do you accept?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div id="faq3" class="faq-answer collapse">
                            <div class="faq-answer-content">
                                We accept all major credit cards (Visa, Mastercard, American Express, Discover) through Stripe, our secure payment processor. Your payment information is encrypted and never stored on our servers.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <button class="faq-question collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                            <span>What's your refund policy?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div id="faq4" class="faq-answer collapse">
                            <div class="faq-answer-content">
                                We offer a 14-day money-back guarantee on all paid plans. If you're not satisfied for any reason, contact us within 14 days of your first payment for a full refund. We want you to feel confident in your investment.
                            </div>
                        </div>
                    </div>

                    <div class="faq-item">
                        <button class="faq-question collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                            <span>What's included in the commercial license?</span>
                            <i class="fas fa-chevron-down"></i>
                        </button>
                        <div id="faq5" class="faq-answer collapse">
                            <div class="faq-answer-content">
                                The Creator tier includes full rights to sell finished needlepoint or cross-stitch pieces made from your patterns—perfect for Etsy sellers and craft fair vendors. You can't resell the digital patterns themselves without a Custom enterprise agreement, but everything you stitch from them is yours to sell!
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Final CTA -->
    <div class="pricing-cta-section">
        <div class="pricing-cta-box">
            <h3 class="cta-title">Still Have Questions?</h3>
            <p class="cta-text">
                Our friendly team is here to help you find the perfect plan for your creative journey.
            </p>
            <a href="mailto:support@stitchlens.com" class="btn btn-primary btn-lg">
                <i class="fas fa-envelope me-2"></i> Contact Support
            </a>
        </div>
    </div>
</div>